= form_for(card, url: card_path(card), as: 'card', remote: true, method:'put' ) do |f|
  = hidden_field_tag :authenticity_token, form_authenticity_token
  %div.accordion-item.d-flex.flow-row(id="card_form_#{card.id}")
    .align-self-center
      .card(id="card_cropped_#{card.card_number}" data-card-number="#{card.card_number}")
        .card-extra-image
          %img(src="/cards/#{card.card_number}.jpg" title="Card ##{card.card_number}")
      .text-start.d-none(id="card_full_#{card.card_number}" data-card-number="#{card.card_number}")
        %img(src="/cards/#{card.card_number}.jpg" title="Card ##{card.card_number}")
    .align-self-center.text-start
      %button(type="button" class="btn p-0 align-top bi bi-arrow-bar-right" data-collapse-card="#{card.card_number}" title="Show detailed image" data-bs-toggle="tooltip") &nbsp;
    .align-self-center.p-3
      .row
        .col-auto.align-middle.mb-3
          = f.label :card_number, class:' align-middle'
          = f.text_field :card_number, class: 'form-control-sm few-chars align-middle'
        .col-auto.align-middle.mb-3
          = f.label :category, class:' align-middle'
          = f.select :category, options_for_select(['Standard', 'Legendary'], card.category), {}, class: 'form-control-sm', title:'Category', data:{ 'bs-toggle'=>'tooltip'}
      .row
        .col-auto.mb-3
          = f.label :name
          = f.text_field :name, class: 'form-control-sm align-middle'
        .col-auto.mb-3.align-middle
          = f.label :type
          = f.select :type, options_for_select([ ['Normal','Card'], ['Replacement','ReplacementCard'] ], card.type), {}, class: 'form-control-sm', title:'Card Type', data:{ 'bs-toggle'=>'tooltip'}
      .row
        .col-auto.mb-3
          = f.label :pawn_rank
          = f.select :pawn_rank, options_for_select([ ['1',1], ['2',2], ['3',3], ['---',-1] ], card.pawn_rank), {}, class: 'form-control-sm', title:'Pawn Rank: 1-3 or Replacement Card', data:{ 'bs-toggle'=>'tooltip'}
        .col-auto.mb-3.align-middle
          = f.label :power
          = f.select :power, options_for_select( 1.upto(10).collect{|p| [p,p]}, card.power), {}, class: 'form-control-sm', title:'Power Increase for Own Tile', data:{ 'bs-toggle'=>'tooltip'}
      .row
        .col-auto.mb-3
          = f.label :description, class:'align-top'
          = f.text_area :description, class: 'form-control-sm align-middle'
      .row
        .col.mb-3.text-end
          = f.submit 'Update', class: 'btn btn-primary btn-sm'
          = link_to 'Edit', edit_card_path(card), class: 'btn btn-secondary btn-sm'
    .align-self-center.p-3.ml-5
      %div
        = render partial:'cards/card_tile_selection_grid', locals: {card: card}
      %div(id="card_ability_form_#{card.id}")
        %h6 Abilities
        - abilities = card.card_abilities.all.to_a 
        - abilities = [CardAbility.new(card_id: card.id) ] if abilities.blank?
        %div(id="card_abilities_#{card.id}")
          - abilities.each_with_index do|card_ability|
            = render partial:'card_abilities/form', locals: {card_ability: card_ability, field_prefix:'card_abilities[]' }