- content_for :more_head do
  = render partial:'/card_assets'
  :css
    :root {
      --pawn-checkbox-color: #ffcb69;
      --affected-checkbox-color: #dd623d;
    }
    .few-chars {
      width: 3.0em;
    }
    .bg-light-box {
      border: solid 0.2em #333333; 
      background-color: #c0c0c0 !important;
    }
    .accordion-item > div {
      display: inline-block;
    }
    .card-tile-selector {
      background-color: #846b6b;
      border: solid 0.35em #333333;
    }
    .card-tile-selector input[type="checkbox"], .card-tile-selector input[type="radio"] {

    }
    .card-tile-selector input[type="checkbox"] {
      margin: 0 0.05em;
      opacity: 0.2;
      cursor: pointer;
    }
    .card-tile-selector input[type="checkbox"]:hover {
      opacity: 0.8;
    }
    .card-tile-selector input[type="checkbox"]:checked, .card-tile-selector input[type="radio"] {
      opacity: 1.0;
    }
    .card-tile-selector input[value="pawn"]:checked, .card-tile-selector input[type="radio"][value="pawn"] {
      color: var(--pawn-checkbox-color);
      background-color: var(--pawn-checkbox-color);
      opacity: 1.0;
      border: 0;
    }
    .card-tile-selector input[value="affected"]:checked, .card-tile-selector input[type="radio"][value="affected"] {
      color: var(--affected-checkbox-color);
      background-color: var(--affected-checkbox-color);
      opacity: 1.0;
      border: 0;
    }
    .card-tile-selector input[type="radio"]:checked {
      border: solid 0.3em rgba(0, 151, 255, 0.6);
      outline: 2px solid rgba(0, 151, 255, 0.4)
    }
    .card-tile-selector input[type="radio"] {
      width: 1.5em;
      height: 1.5em;
    }
    .card-tile-selector .self-tile {
      background-color: white;
    }
    .card-tile-selector tr {
      line-height: 1.0em;
      min-height: 1.0em;
      margin: 0;
    }
    .card-tile-selector td {
      border: solid 0.2em #333333;
    }

  :javascript
    function setCardInteractions() 
    {
      $('[data-bs-toggle="tooltip"]').tooltip();

      $('.card-tile-selector input[type="checkbox"]').change(function() {
        var whichType = $('input[name="card_tile_type_' + $(this).data('card-number') + '"][value="affected"]').is(':checked') ? 'affected' : 'pawn';
        ///////////console.log("Checkbox clicked for card "+ $(this).data('card-number') + ", type "+ whichType);
        if ( $(this).prop('checked') == true ) {
          $(this).val( whichType );
        } else {
          $(this).val('');
        }
      });

      $('button[data-collapse-card]').click(function() {
        var cardNumber = $(this).data('collapse-card');
        if ( $("#card_cropped_" + cardNumber).hasClass('d-none') == false ) {
          $(this).removeClass('bi-arrow-bar-right');
          $(this).addClass('bi-arrow-bar-left');
          //$(this).attr('title', 'Hide detailed image');
          $(this).attr('data-bs-original-title', 'Hide detailed image');
          $("#card_cropped_" + cardNumber ).addClass('d-none');
          $("#card_full_" + cardNumber ).removeClass('d-none');
        } else {
          $(this).removeClass('bi-arrow-bar-left');
          $(this).addClass('bi-arrow-bar-right');
          //$(this).attr('title', 'Show detailed image');
          $(this).attr('data-bs-original-title', 'Show detailed image');
          $("#card_cropped_" + cardNumber ).removeClass('d-none');
          $("#card_full_" + cardNumber ).addClass('d-none');
        }
      } );
    }

    $(document).ready(setCardInteractions);

%div(class="accordion container" id="cards_accordion")
  - @cards.each do|card|
    = form_for(card, url: card_path(card), as: 'card', remote: true, method:'put' ) do |f|
      = hidden_field_tag :authenticity_token, form_authenticity_token
      %div.accordion-item.d-flex.flow-row
        .align-self-center
          .card(id="card_cropped_#{card.card_number}" data-card-number="#{card.card_number}")
            .card-extra-image
              %img(src="/cards/#{card.card_number}.jpg" title="Card ##{card.card_number}")
          .align-left.d-none(id="card_full_#{card.card_number}" data-card-number="#{card.card_number}")
            %img(src="/cards/#{card.card_number}.jpg" title="Card ##{card.card_number}")
        .align-self-center.align-left
          %button(type="button" class="btn p-0 align-top bi bi-arrow-bar-right" data-collapse-card="#{card.card_number}" title="Show detailed image" data-bs-toggle="tooltip") &nbsp;
        .align-self-center.p-3
          .row
            .col-auto.align-middle.mb-3
              = f.label :card_number, class:' align-middle'
              = f.text_field :card_number, class: 'form-control-sm few-chars align-middle'
            .col-auto.align-middle.mb-3
              = f.label :category, class:' align-middle'
              = f.select :category, options_for_select(['Standard', 'Legendary'], card.category), {}, class: 'form-control-sm', title:'Category', data:{ 'bs-toggle'=>'tooltip'}
          .row
            .col-auto.mb-3
              = f.label :name
              = f.text_field :name, class: 'form-control-sm align-middle'
            .col-auto.mb-3.align-middle
              = f.label :type
              = f.select :type, options_for_select([ ['Normal','Card'], ['Replacement','ReplacementCard'] ], card.type), {}, class: 'form-control-sm', title:'Card Type', data:{ 'bs-toggle'=>'tooltip'}
          .row
            .col-auto.mb-3
              = f.label :pawn_rank
              = f.select :pawn_rank, options_for_select([ ['1',1], ['2',2], ['3',3], ['---',-1] ], card.pawn_rank), {}, class: 'form-control-sm', title:'Pawn Rank: 1-3 or Replacement Card', data:{ 'bs-toggle'=>'tooltip'}
            .col-auto.mb-3.align-middle
              = f.label :power
              = f.select :power, options_for_select( 1.upto(10).collect{|p| [p,p]}, card.power), {}, class: 'form-control-sm', title:'Power Increase for Own Tile', data:{ 'bs-toggle'=>'tooltip'}
          .row
            .col-auto.mb-3
              = f.label :description, class:'align-top'
              = f.text_area :description, class: 'form-control-sm align-middle'
          .row
            .col.mb-3.align-right
              = f.submit 'Update', class: 'btn btn-primary btn-sm'
        .align-self-center.p-3.ml-5
          %div
            = render partial:'cards/card_tile_selection_grid', locals: {card: card}
          %div
            = card.pawn_tiles_data
          %div
            = card.affected_tiles_data
          %div
            - if card.card_abilities.present?
              %h6 Abilities
              %ul.list-group
                - card.card_abilities.each do|ability|
                  %li.list-group-item= ability.attributes
            - else
              %p No abilities
.container
  .align-center.mt-3
    = paginate @cards